<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Duck Racing ‚Äî Smooth Boost</title>

<style>
/* --- C·∫•u tr√∫c c∆° b·∫£n --- */
body{margin:0;background:#0f172a;color:#fff;font-family:Inter,system-ui;display:flex;justify-content:center;min-height:100vh}
.container{max-width:100%;width:100%;padding:16px;display:flex;flex-direction:column; box-sizing: border-box;}
.card{background:#111827;border-radius:16px;padding:20px;box-shadow:0 10px 28px rgba(0,0,0,.5);margin-bottom:14px;border:1px solid #1f2937}

h2 {margin-top:0; color:#38bdf8; text-shadow: 0 0 10px rgba(56,189,248,0.3);}
p {margin-bottom: 6px; font-size: 0.9em; color: #94a3b8;}
textarea{width:100%;min-height:100px;border-radius:12px;border:1px solid #334155;background:#020617;color:#e2e8f0;padding:12px;font-family:monospace;resize:vertical;box-sizing:border-box;}
textarea:focus{outline:2px solid #38bdf8;border-color:transparent}

.buttons{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
button{width:100%;padding:14px;border-radius:12px;border:none;font-weight:700;font-size:16px;cursor:pointer;transition:transform 0.1s}
button:active{transform:scale(0.98)}
#startBtn{background:#22c55e;color:#000}
#startBtn:hover{background:#16a34a}
.reset{background:#38bdf8;color:#000}

/* --- Khung b√¨nh lu·∫≠n --- */
.commentary-box {
    background: #1e1b4b;
    color: #e0e7ff;
    padding: 12px 16px;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 15px;
    border: 1px solid #4338ca;
    min-height: 24px;
    display: flex; align-items: center;
    transition: all 0.3s;
}
.commentary-box.active { border-color: #818cf8; box-shadow: 0 0 10px rgba(129,140,248,0.4); }

/* --- ƒê∆∞·ªùng ƒëua --- */
.timer{font-size:24px;font-weight:bold;text-align:center;margin:10px 0;color:#fbbf24}

.track-scroll-wrapper {
  width: 100%;
  overflow-x: auto;
  border-radius: 12px;
  border: 1px solid #1e293b;
  background:#020617;
  margin-top:12px;
  scroll-behavior: smooth;
}

.track {
  position:relative;
  width: 5000px;
  padding:15px 10px;
  overflow:hidden;
  min-height:60px;
  background-image: linear-gradient(90deg, #1e293b 1px, transparent 1px);
  background-size: 200px 100%; /* V·∫°ch k·∫ª m·ªói 200px */
}

.finish{position:absolute;right:10px;top:0;bottom:0;width:12px;background:repeating-linear-gradient(45deg, #ef4444, #ef4444 10px, #fff 10px, #fff 20px);z-index:1;}

/* --- Con v·ªãt --- */
.duck{
  display:flex;align-items:center;gap:8px;
  font-size:18px; font-weight: 600;
  margin:15px 0;
  position:relative;
  left:0;
  white-space:nowrap;
  z-index:2;
  transition: transform 0.3s ease-out; /* M∆∞·ª£t m√† h∆°n */
}
.duck span:first-child {font-size: 28px; display: inline-block;}

/* Hi·ªáu ·ª©ng TR·ª∞C QUAN ƒë·ªÉ nh√¨n r√µ b·ª©t t·ªëc */
.duck.boosted {
    filter: drop-shadow(0 0 8px #fbbf24);
}
.duck.boosted span:first-child {
    transform: scale(1.3) skewX(-10deg); /* Nghi√™ng ng∆∞·ªùi v·ªÅ ph√≠a tr∆∞·ªõc */
    animation: fire 0.2s infinite alternate;
}
@keyframes fire { from{filter: brightness(1);} to{filter: brightness(1.5) contrast(1.2);} }

.duck.stunned { opacity: 0.4; filter: grayscale(100%) blur(1px); }
.duck.fury { color: #f87171; text-shadow: 0 0 5px red; }

/* --- B·∫£ng x·∫øp h·∫°ng --- */
#board {padding:0; margin-top: 10px;}
#board li{
  list-style:none; margin:8px 0; padding:12px; border-radius:10px; background:#1e293b; display:flex; justify-content:space-between; border: 1px solid #334155;
}
#board li.top1{background:#fde047;color:#000;}

@keyframes popIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }
</style>
</head>

<body>
<div class="container">
  <div class="card">
    <h2 style="text-align:center">üê§ Duck Racing ‚Äî Smooth Mode</h2>
    <textarea id="names" placeholder="Nh·∫≠p t√™n v·ªãt..."></textarea>

    <div class="buttons">
      <button id="startBtn">üèÅ ƒêua ngay</button>
      <button id="resetBtn" class="reset">üîÑ L√†m m·ªõi</button>
    </div>

    <div class="timer" id="timer">0.00s</div>
    <div class="commentary-box" id="commentary">üì¢ S·∫µn s√†ng...</div>

    <div class="track-scroll-wrapper" id="scrollContainer">
        <div class="track" id="track">
          <div class="finish"></div>
        </div>
    </div>

    <h3>üèÜ B·∫£ng x·∫øp h·∫°ng</h3>
    <ul id="board"></ul>
  </div>
</div>

<script>
const btn = document.getElementById("startBtn");
const resetBtn = document.getElementById("resetBtn");
const track = document.getElementById("track");
const scrollContainer = document.getElementById("scrollContainer");
const board = document.getElementById("board");
const timerEl = document.getElementById("timer");
const commentaryEl = document.getElementById("commentary");

let ducks = [], results = [], running = false, startTime = 0, timerLoop = null, finishX = 0;
let msgQueue = [];
let isAnnouncing = false;

function log(msg, important = false) {
    if(important) msgQueue.unshift(msg);
    else msgQueue.push(msg);
    processQueue();
}

function processQueue() {
    if(isAnnouncing || msgQueue.length === 0) return;
    isAnnouncing = true;
    const msg = msgQueue.shift();
    commentaryEl.innerHTML = `üì¢ ${msg}`;
    commentaryEl.classList.add("active");
    setTimeout(() => {
        commentaryEl.classList.remove("active");
        isAnnouncing = false;
        processQueue();
    }, 1800); // TƒÉng th·ªùi gian ƒë·ªçc l√™n 1.8s
}

function reset(){
  running = false; results = []; board.innerHTML = ""; timerEl.textContent = "0.00s";
  msgQueue = []; isAnnouncing = false; commentaryEl.textContent = "üì¢ S·∫µn s√†ng...";
  clearInterval(timerLoop);
  scrollContainer.scrollLeft = 0;
  track.innerHTML = '<div class="finish"></div>';
}

function startRace(){
  if(running) return;
  const names = document.getElementById("names").value.split("\n").map(s => s.trim()).filter(Boolean);
  if(!names.length) return;
  reset(); 
  finishX = track.offsetWidth - 120; 

  ducks = names.map((name) => {
    const d = document.createElement("div");
    d.className = "duck";
    d.dataset.x = 0;
    d.dataset.name = name;
    d.dataset.done = "0";
    d.dataset.status = "run";
    d.dataset.lockTime = 0;
    d.dataset.speed = 2 + Math.random() * 1; // T·ªëc ƒë·ªô c∆° s·ªü
    d.innerHTML = `<span>ü¶Ü</span><span>${name}</span>`;
    track.appendChild(d);
    return d;
  });

  running = true;
  startTime = performance.now();
  timerLoop = setInterval(() => {
    const t = ((performance.now() - startTime) / 1000).toFixed(2);
    timerEl.textContent = "‚è± " + t + "s";
  }, 50);
  requestAnimationFrame(loop);
}

function loop(){
  if(!running) return;
  let finishedCount = 0;
  let leadingX = 0; 
  ducks.forEach(d => { if(d.dataset.done === "0" && parseFloat(d.dataset.x) > leadingX) leadingX = parseFloat(d.dataset.x); });

  ducks.forEach(d => {
    if(d.dataset.done === "1") { finishedCount++; return; }

    let x = parseFloat(d.dataset.x);
    let name = d.dataset.name;
    let lockTime = parseInt(d.dataset.lockTime);
    let status = d.dataset.status;

    // QU·∫¢N L√ù TR·∫†NG TH√ÅI
    if(lockTime > 0) {
        d.dataset.lockTime = lockTime - 1;
        if(status === "sleep") return; 
    } else if(status !== "run") {
        d.className = "duck";
        d.dataset.status = "run";
    }

    // T√çNH TO√ÅN T·ªêC ƒê·ªò (ƒê√É L√ÄM CH·∫¨M L·∫†I ƒê·ªÇ D·ªÑ NH√åN)
    let currentSpeed = parseFloat(d.dataset.speed) + (Math.random() * 0.5);

    if(status === "boost") {
        currentSpeed += 6; // Gi·∫£m t·ª´ 15 xu·ªëng 6 ƒë·ªÉ b·ª©t t·ªëc m∆∞·ª£t m√†
    }
    
    // Fury Mode (L·ªôi ng∆∞·ª£c d√≤ng)
    if(status === "run" && (leadingX - x > 800)) {
        d.classList.add("fury");
        currentSpeed += 3.5; 
    }

    // RANDOM EVENTS (T·ªâ l·ªá c·ª±c th·∫•p ƒë·ªÉ tin nh·∫Øn kh√¥ng b·ªã ch·ªìng ch√©o)
    if(status === "run" && Math.random() < 0.003) {
        if(Math.random() < 0.5) {
            d.dataset.status = "sleep";
            d.dataset.lockTime = 100;
            d.classList.add("stunned");
            log(`${name} ƒëang d·ª´ng l·∫°i... th·ªü d·ªëc!`);
        } else {
            d.dataset.status = "boost";
            d.dataset.lockTime = 120; // K√©o d√†i th·ªùi gian boost l√™n ƒë·ªÉ nh√¨n cho r√µ
            d.classList.add("boosted");
            log(`${name} B·∫ÆT ƒê·∫¶U TƒÇNG T·ªêC!`);
        }
    }

    x += currentSpeed;

    if(x >= finishX){
      x = finishX;
      d.dataset.done = "1";
      d.className = "duck";
      const t = (performance.now() - startTime) / 1000;
      results.push({ name: name, time: t });
      log(`C√°n ƒë√≠ch: ${name}!`, true);
      updateRanking();
    }

    d.dataset.x = x;
    d.style.left = x + "px";
  });

  // CAMERA (L√ÄM M∆Ø·ª¢T CU·ªòN)
  const centerOffset = scrollContainer.clientWidth / 3;
  if(leadingX > centerOffset) {
      scrollContainer.scrollLeft = leadingX - centerOffset;
  }

  if(finishedCount === ducks.length && ducks.length > 0){
    running = false; clearInterval(timerLoop);
  } else {
    requestAnimationFrame(loop);
  }
}

function updateRanking(){
  results.sort((a,b) => a.time - b.time);
  board.innerHTML = ""; 
  results.forEach((r, i) => {
    const li = document.createElement("li");
    li.innerHTML = `<span>#${i+1} ${r.name}</span><span>${r.time.toFixed(2)}s</span>`;
    if(i === 0) li.classList.add("top1");
    board.appendChild(li);
  });
}

btn.onclick = startRace;
resetBtn.onclick = reset;
</script>
</body>
</html>
