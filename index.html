<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Duck Racing â€” Chaos Edition</title>

<style>
/* --- Cáº¥u trÃºc cÆ¡ báº£n --- */
body{margin:0;background:#0f172a;color:#fff;font-family:Inter,system-ui;display:flex;justify-content:center;min-height:100vh}
.container{max-width:100%;width:100%;padding:16px;display:flex;flex-direction:column; box-sizing: border-box;}
.card{background:#111827;border-radius:16px;padding:20px;box-shadow:0 10px 28px rgba(0,0,0,.5);margin-bottom:14px;border:1px solid #1f2937}

h2 {margin-top:0; color:#38bdf8; text-shadow: 0 0 10px rgba(56,189,248,0.3);}
p {margin-bottom: 6px; font-size: 0.9em; color: #94a3b8;}
textarea{width:100%;min-height:100px;border-radius:12px;border:1px solid #334155;background:#020617;color:#e2e8f0;padding:12px;font-family:monospace;resize:vertical;box-sizing:border-box;}
textarea:focus{outline:2px solid #38bdf8;border-color:transparent}

.buttons{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
button{width:100%;padding:14px;border-radius:12px;border:none;font-weight:700;font-size:16px;cursor:pointer;transition:transform 0.1s}
button:active{transform:scale(0.98)}
#startBtn{background:#22c55e;color:#000}
#startBtn:hover{background:#16a34a}
.reset{background:#38bdf8;color:#000}
.reset:hover{background:#0ea5e9}

/* --- Khu vá»±c thÃ´ng bÃ¡o (Má»›i) --- */
.commentary-box {
    background: #431407;
    color: #fdba74;
    padding: 8px 12px;
    border-radius: 8px;
    margin-top: 10px;
    font-size: 14px;
    font-family: monospace;
    border: 1px solid #ea580c;
    min-height: 24px;
    display: flex; align-items: center;
    overflow: hidden;
}
.blink-text { animation: blink 0.5s infinite alternate; font-weight: bold; color: #fff;}
@keyframes blink { from{opacity:1} to{opacity:0.5} }

/* --- ÄÆ°á»ng Ä‘ua --- */
.timer{font-size:24px;font-weight:bold;text-align:center;margin:10px 0;font-variant-numeric:tabular-nums;color:#fbbf24}

.track-scroll-wrapper {
  width: 100%;
  overflow-x: auto;
  border-radius: 12px;
  border: 1px solid #1e293b;
  background:#020617;
  margin-top:12px;
}

.track {
  position:relative;
  width: 5000px; /* Äua Ä‘Æ°á»ng dÃ i 5000px */
  padding:10px 10px 10px 0;
  overflow:hidden;
  min-height:50px;
  background-image: repeating-linear-gradient(90deg, transparent 0, transparent 499px, #334155 500px);
}
/* Sá»‘ mÃ©t trÃªn Ä‘Æ°á»ng Ä‘ua */
.track::after {
    content: "500m 1000m 1500m 2000m 2500m 3000m 3500m 4000m 4500m";
    position: absolute; bottom: 0; left: 0; right: 0;
    font-size: 10px; color: #475569; letter-spacing: 470px; padding-left: 500px; pointer-events: none;
}

.finish{position:absolute;right:10px;top:0;bottom:0;width:10px;background:repeating-linear-gradient(45deg, #ef4444, #ef4444 10px, #fff 10px, #fff 20px);z-index:1; border-left: 2px solid #fff;}

/* --- Con vá»‹t --- */
.duck{
  display:flex;align-items:center;gap:6px;
  font-size:18px; font-weight: 600;
  margin:12px 0;
  position:relative;
  left:0;
  white-space:nowrap;
  z-index:2;
  transition: transform 0.2s, filter 0.2s; 
}
.duck span:first-child {font-size: 26px; transition: all 0.2s;}

/* Hiá»‡u á»©ng Ä‘áº·c biá»‡t */
.duck.stunned { opacity: 0.5; filter: grayscale(100%); }
.duck.stunned span:first-child { transform: rotate(180deg); } /* Lá»™n cá»• */

.duck.boosted span:first-child { transform: scale(1.5); filter: drop-shadow(0 0 10px orange); }
.duck.fury { color: #f87171; }
.duck.fury span:first-child { animation: shake 0.1s infinite; filter: drop-shadow(0 0 5px red); }

@keyframes shake {
  0% { transform: translate(1px, 1px) rotate(0deg); }
  50% { transform: translate(-1px, -1px) rotate(-1deg); }
  100% { transform: translate(1px, -1px) rotate(1deg); }
}

/* --- Báº£ng xáº¿p háº¡ng --- */
#board {padding:0; margin-top: 10px;}
#board li{
  list-style:none; margin:8px 0; padding:12px; border-radius:10px; background:#1e293b; color:#fff; 
  font-weight:600; display:flex; justify-content:space-between; border: 1px solid #334155;
  animation: popIn 0.3s ease-out;
}
#board li.top1{background:#fde047;color:#000; border-color:#facc15}
#board li.top2{background:#e5e7eb;color:#000; border-color:#d1d5db}
#board li.top3{background:#fb923c;color:#000; border-color:#f97316}

@keyframes popIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }
</style>
</head>

<body>
<div class="container">
  <div class="card">
    <h2 style="text-align:center">ğŸ¤ Duck Racing â€” Chaos Edition</h2>

    <p>Nháº­p tÃªn cÃ¡c tay Ä‘ua:</p>
    <textarea id="names" placeholder="Vá»‹t Donal&#10;Vá»‹t Daisy&#10;Psyduck..."></textarea>

    <div class="buttons">
      <button id="startBtn">ğŸ Báº¯t Ä‘áº§u Chaos</button>
      <button id="resetBtn" class="reset">ğŸ”„ LÃ m má»›i</button>
    </div>

    <div class="timer" id="timer">0.00s</div>
    
    <div class="commentary-box" id="commentary">
        ğŸ“¢ Sáºµn sÃ ng...
    </div>

    <div class="track-scroll-wrapper" id="scrollContainer">
        <div class="track" id="track">
          <div class="finish"></div>
          <div style="color:#475569; text-align:center; padding:20px; width: 300px;">ÄÆ°á»ng Ä‘ua tá»­ tháº§n dÃ i 5000m...</div>
        </div>
    </div>

    <h3>ğŸ† Báº£ng xáº¿p háº¡ng</h3>
    <ul id="board"></ul>
  </div>
</div>

<script>
const btn = document.getElementById("startBtn");
const resetBtn = document.getElementById("resetBtn");
const track = document.getElementById("track");
const scrollContainer = document.getElementById("scrollContainer");
const board = document.getElementById("board");
const timerEl = document.getElementById("timer");
const commentaryEl = document.getElementById("commentary");

let ducks = [], results = [], running = false, startTime = 0, timerLoop = null, finishX = 0;
let defaultIcons = ['ğŸ¦†', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¦…'];

function log(msg) {
    commentaryEl.innerHTML = `<span class="blink-text">ğŸ“¢ TIN NÃ“NG:</span> ${msg}`;
}

function reset(){
  running = false;
  results = [];
  board.innerHTML = "";
  timerEl.textContent = "0.00s";
  commentaryEl.textContent = "ğŸ“¢ Sáºµn sÃ ng...";
  clearInterval(timerLoop);
  scrollContainer.scrollLeft = 0;
  track.innerHTML = '<div class="finish"></div>';
}

function startRace(){
  if(running) return;
  const names = document.getElementById("names").value.split("\n").map(s => s.trim()).filter(Boolean);
  if(!names.length){ alert("Nháº­p tÃªn vá»‹t Ä‘i báº¡n Æ¡i!"); return; }

  reset(); 
  finishX = track.offsetWidth - 100; 

  ducks = names.map((name) => {
    const d = document.createElement("div");
    d.className = "duck";
    // Setup chá»‰ sá»‘
    d.dataset.x = 0;
    d.dataset.name = name;
    d.dataset.done = "0";
    d.dataset.status = "run"; // run | sleep | boost
    d.dataset.lockTime = 0;   // Thá»i gian bá»‹ khÃ³a status
    
    // Icon random
    const icon = defaultIcons[Math.floor(Math.random() * defaultIcons.length)];
    d.dataset.icon = icon;
    
    d.innerHTML = `<span>${icon}</span><span>${name}</span>`;
    d.style.left = "0px";
    track.appendChild(d);
    return d;
  });

  running = true;
  startTime = performance.now();

  timerLoop = setInterval(() => {
    const t = ((performance.now() - startTime) / 1000).toFixed(2);
    timerEl.textContent = "â± " + t + "s";
  }, 50);

  requestAnimationFrame(loop);
}

function loop(){
  if(!running) return;

  let finishedCount = 0;
  let leadingX = 0; 
  let lastX = 999999;

  // TÃ¬m vá»‹ trÃ­ Ä‘áº§u vÃ  cuá»‘i Ä‘á»ƒ tÃ­nh toÃ¡n logic "lá»™i ngÆ°á»£c dÃ²ng"
  ducks.forEach(d => {
      let x = parseFloat(d.dataset.x);
      if(d.dataset.done === "0") {
          if(x > leadingX) leadingX = x;
          if(x < lastX) lastX = x;
      }
  });

  ducks.forEach(d => {
    if(d.dataset.done === "1") {
      finishedCount++;
      return;
    }

    let x = parseFloat(d.dataset.x);
    let name = d.dataset.name;
    let iconSpan = d.querySelector("span:first-child");
    let status = d.dataset.status;
    let lockTime = parseInt(d.dataset.lockTime);

    // --- Xá»¬ LÃ TRáº NG THÃI ---
    if(lockTime > 0) {
        d.dataset.lockTime = lockTime - 1;
        
        // Náº¿u Ä‘ang ngá»§ thÃ¬ khÃ´ng di chuyá»ƒn
        if(status === "sleep") return; 
    } else {
        // Háº¿t thá»i gian hiá»‡u á»©ng -> Reset vá» bÃ¬nh thÆ°á»ng
        if(status !== "run") {
            d.className = "duck"; // XÃ³a class effect
            d.dataset.status = "run";
            iconSpan.textContent = d.dataset.icon;
        }
    }

    // --- TÃNH TOÃN DI CHUYá»‚N ---
    let move = 2 + Math.random() * 2; // Tá»‘c Ä‘á»™ cÆ¡ báº£n (nhanh hÆ¡n báº£n cÅ©)

    // 1. LOGIC BOOST (TÃªn lá»­a)
    if(status === "boost") {
        move += 15; // Tá»‘c Ä‘á»™ bÃ n thá»
    }
    
    // 2. LOGIC FURY (Lá»™i ngÆ°á»£c dÃ²ng)
    // Náº¿u bá»‹ bá» láº¡i quÃ¡ 500px so vá»›i ngÆ°á»i dáº«n Ä‘áº§u -> HÃ³a thÃº
    if(status === "run" && (leadingX - x > 500)) {
        d.classList.add("fury");
        move += 6; // Cháº¡y nhanh hÆ¡n Ä‘á»ƒ Ä‘uá»•i theo
        iconSpan.textContent = "ğŸ‘¹"; 
    } else if (status === "run") {
        d.classList.remove("fury");
        if(iconSpan.textContent === "ğŸ‘¹") iconSpan.textContent = d.dataset.icon;
    }

    // --- Sá»° KIá»†N NGáºªU NHIÃŠN (Chá»‰ xáº£y ra khi Ä‘ang cháº¡y bÃ¬nh thÆ°á»ng) ---
    if(status === "run" && Math.random() < 0.015) { // 1.5% cÆ¡ há»™i má»—i frame
        const dice = Math.random();
        
        if(dice < 0.3) {
            // 30% dÃ­nh CHOÃNG (Sleep)
            d.dataset.status = "sleep";
            d.dataset.lockTime = 100; // Ngá»§ 100 frames (~1.6s)
            d.classList.add("stunned");
            iconSpan.textContent = "ğŸ’«";
            log(`${name} váº¥p vá» chuá»‘i vÃ  ngáº¥t xá»‰u!`);
        } 
        else if (dice > 0.8) {
            // 20% dÃ­nh BOOST (TÃªn lá»­a)
            d.dataset.status = "boost";
            d.dataset.lockTime = 60; // Boost trong 60 frames (~1s)
            d.classList.add("boosted");
            iconSpan.textContent = "ğŸ”¥";
            log(`${name} vá»«a nháº·t Ä‘Æ°á»£c tÃªn lá»­a!!`);
        }
    }

    x += move;

    // Vá» Ä‘Ã­ch
    if(x >= finishX){
      x = finishX;
      d.dataset.done = "1";
      d.className = "duck"; // XÃ³a má»i effect
      iconSpan.textContent = "ğŸ"; 
      
      const t = (performance.now() - startTime) / 1000;
      results.push({ name: name, time: t });
      
      log(`${name} ÄÃƒ Vá»€ ÄÃCH!`);
      updateRanking();
    }

    d.dataset.x = x;
    d.style.left = x + "px";
  });

  // --- CAMERA UPDATE ---
  const centerOffset = scrollContainer.clientWidth / 2;
  if(leadingX > centerOffset) {
      scrollContainer.scrollLeft = leadingX - centerOffset;
  }

  if(finishedCount === ducks.length && ducks.length > 0){
    running = false;
    clearInterval(timerLoop);
    timerEl.textContent = "ğŸ GAME OVER";
    log("Cuá»™c Ä‘ua káº¿t thÃºc! Xem báº£ng xáº¿p háº¡ng bÃªn dÆ°á»›i.");
  } else {
    requestAnimationFrame(loop);
  }
}

function updateRanking(){
  results.sort((a,b) => a.time - b.time);
  board.innerHTML = ""; 

  results.forEach((r, i) => {
    const li = document.createElement("li");
    let rankPrefix = `#${i+1}`;
    if(i===0) rankPrefix = "ğŸ¥‡";
    if(i===1) rankPrefix = "ğŸ¥ˆ";
    if(i===2) rankPrefix = "ğŸ¥‰";

    li.innerHTML = `<span>${rankPrefix} ${r.name}</span><span>${r.time.toFixed(2)}s</span>`;
    if(i === 0) li.classList.add("top1");
    if(i === 1) li.classList.add("top2");
    if(i === 2) li.classList.add("top3");
    board.appendChild(li);
  });
}

btn.onclick = startRace;
resetBtn.onclick = reset;
</script>
</body>
</html>
