<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ƒêua Th√∫ Si√™u C·∫•p</title>
<style>
body{margin:0;background:#0f172a;color:#fff;font-family:system-ui;display:flex;justify-content:center;min-height:100vh}
.container{max-width:1000px;width:100%;padding:10px;display:flex;flex-direction:column;box-sizing:border-box}
.card{background:#111827;border-radius:16px;padding:15px;box-shadow:0 10px 25px rgba(0,0,0,.5);border:1px solid #1f2937}

h2{text-align:center;color:#38bdf8;margin:5px 0; text-transform: uppercase;}
.timer{font-size:24px;text-align:center;color:#fbbf24;font-weight:bold;margin-bottom:10px;font-family:monospace}
.commentary-box{background:#1e1b4b;color:#e0e7ff;padding:10px;border-radius:8px;font-size:14px;border:1px solid #4338ca;min-height:22px;margin-bottom:15px;text-align:center}

/* ƒê∆Ø·ªúNG ƒêUA */
.track-wrapper {
  width: 100%;
  overflow-x: auto;
  overflow-y: hidden;
  background:#020617;
  border:1px solid #1e293b;
  border-radius:12px;
  position: relative;
}
.track {
  position:relative;
  width: 4000px;
  background-image: linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
  background-size: 200px 100%;
  padding: 10px 0;
}
.finish-line {
  position:absolute;
  right:120px;
  top:0; bottom:0;
  width:20px;
  background: repeating-linear-gradient(45deg, #ef4444, #ef4444 8px, #fff 8px, #fff 16px);
  border-left: 4px solid white;
}

/* V·∫¨N ƒê·ªòNG VI√äN */
.racer {
  position: absolute;
  left: 0;
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 600;
  height: 50px;
  padding: 0 10px;
  z-index: 2;
  white-space: nowrap;
}
.racer img {
  width: 40px;
  height: 40px;
  object-fit: contain;
  transition: transform 0.2s;
}

/* HI·ªÜU ·ª®NG */
.racer.boosted img {
  filter: drop-shadow(0 0 10px #fbbf24) brightness(1.2);
  transform: scale(1.3) skewX(-10deg);
}
.racer.stunned { opacity: 0.5; filter: grayscale(1); }

.buttons{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:10px 0}
button{padding:12px;border-radius:8px;border:none;font-weight:700;cursor:pointer}
#startBtn{background:#22c55e;color:#000}
#resetBtn{background:#38bdf8;color:#000}

#board { padding:0; list-style:none; }
#board li {
  background:#1e293b; padding:10px 15px; margin-bottom:5px;
  border-radius:8px; display:flex; justify-content:space-between;
}
.top1 { background: #fde047 !important; color: #000; font-weight: bold; }
</style>
</head>

<body>
<div class="container">
  <div class="card">
    <h2>üèÜ ƒêua Th√∫ Si√™u C·∫•p</h2>
    <div class="buttons">
      <button id="startBtn">üöÄ B·∫ÆT ƒê·∫¶U</button>
      <button id="resetBtn">üîÑ L√ÄM M·ªöI</button>
    </div>

    <div class="timer" id="timer">00.00s</div>
    <div class="commentary-box" id="commentary">üì¢ Chu·∫©n b·ªã xu·∫•t ph√°t!</div>

    <div class="track-wrapper" id="scrollContainer">
      <div class="track" id="track">
        <div class="finish-line"></div>
      </div>
    </div>

    <h3>üìä X·∫øp H·∫°ng</h3>
    <ul id="board"></ul>
  </div>
</div>

<script>
const track = document.getElementById('track');
const scrollContainer = document.getElementById('scrollContainer');
const commentaryEl = document.getElementById('commentary');
const board = document.getElementById('board');
const timerEl = document.getElementById('timer');

// D·ªØ li·ªáu ·∫£nh th·ª±c t·∫ø (S·ª≠ d·ª•ng icon ƒë·ªông v·∫≠t t·ª´ ngu·ªìn m·ªü)
const animalData = [
    { name: "C√°o", img: "https://cdn-icons-png.flaticon.com/512/235/235368.png" },
    { name: "G·∫•u", img: "https://cdn-icons-png.flaticon.com/512/235/235345.png" },
    { name: "H·ªï", img: "https://cdn-icons-png.flaticon.com/512/1998/1998815.png" },
    { name: "G√†", img: "https://cdn-icons-png.flaticon.com/512/2632/2632839.png" },
    { name: "Chim", img: "https://cdn-icons-png.flaticon.com/512/2000/2000286.png" },
    { name: "Nai", img: "https://cdn-icons-png.flaticon.com/512/2219/2219758.png" },
    { name: "H∆∞∆°u", img: "https://cdn-icons-png.flaticon.com/512/2219/2219754.png" }
];

let racers = [], results = [], running = false, startTime = 0;
let msgQueue = [], isAnnouncing = false;

function log(msg) {
    msgQueue.push(msg);
    if(!isAnnouncing) showNextMsg();
}

function showNextMsg() {
    if(msgQueue.length === 0) { isAnnouncing = false; return; }
    isAnnouncing = true;
    commentaryEl.innerHTML = `üì¢ <b>${msgQueue.shift()}</b>`;
    setTimeout(() => showNextMsg(), 1500);
}

function startRace() {
    if(running) return;
    running = false; results = []; board.innerHTML = "";
    track.querySelectorAll('.racer').forEach(r => r.remove());
    scrollContainer.scrollLeft = 0;

    track.style.height = (animalData.length * 60 + 20) + "px";

    racers = animalData.map((animal, i) => {
        const r = document.createElement('div');
        r.className = 'racer';
        r.innerHTML = `<img src="${animal.img}"> <span>${animal.name}</span>`;
        r.style.top = (i * 60 + 10) + "px";
        r.dataset.x = 0;
        r.dataset.name = animal.name;
        r.dataset.status = "run";
        r.dataset.statusTimer = 0;
        r.dataset.cooldown = 0;
        r.dataset.done = "0";
        track.appendChild(r);
        return r;
    });

    running = true;
    startTime = performance.now();
    requestAnimationFrame(update);
}

function update() {
    if(!running) return;
    const elapsed = ((performance.now() - startTime) / 1000).toFixed(2);
    timerEl.textContent = elapsed + "s";

    let leadingX = 0;
    let finishedCount = 0;
    const finishX = track.offsetWidth - 150;

    racers.forEach(r => {
        if(r.dataset.done === "1") { finishedCount++; return; }

        let x = parseFloat(r.dataset.x);
        let sTimer = parseInt(r.dataset.statusTimer);
        let cooldown = parseInt(r.dataset.cooldown);

        if(sTimer > 0) r.dataset.statusTimer = sTimer - 1;
        if(cooldown > 0) r.dataset.cooldown = cooldown - 1;

        if(sTimer === 0 && r.dataset.status !== "run") {
            r.dataset.status = "run";
            r.classList.remove('boosted', 'stunned');
        }

        let speed = 2.0 + Math.random() * 1.5;
        if(r.dataset.status === "boost") speed += 2.5;
        if(r.dataset.status === "stun") speed = 0;

        if(r.dataset.status === "run" && cooldown === 0 && Math.random() < 0.008) {
            if(Math.random() > 0.4) {
                r.dataset.status = "boost";
                r.dataset.statusTimer = 40;
                r.dataset.cooldown = 300;
                r.classList.add('boosted');
                log(r.dataset.name + " ƒëang b·ª©t t·ªëc!");
            } else {
                r.dataset.status = "stun";
                r.dataset.statusTimer = 40;
                r.dataset.cooldown = 150;
                r.classList.add('stunned');
                log(r.dataset.name + " b·ªã tr∆∞·ª£t ch√¢n!");
            }
        }

        x += speed;
        r.dataset.x = x;
        r.style.left = x + "px";
        if(x > leadingX) leadingX = x;

        if(x >= finishX) {
            r.dataset.done = "1";
            results.push({name: r.dataset.name, time: elapsed});
            log(r.dataset.name + " ƒë√£ v·ªÅ ƒë√≠ch!");
            updateBoard();
        }
    });

    if(leadingX > scrollContainer.offsetWidth / 2) {
        scrollContainer.scrollLeft = leadingX - scrollContainer.offsetWidth / 2;
    }

    if(finishedCount < racers.length) requestAnimationFrame(update);
    else running = false;
}

function updateBoard() {
    board.innerHTML = results.map((r, i) => 
        `<li class="${i===0?'top1':''}"><span>#${i+1} ${r.name}</span> <span>${r.time}s</span></li>`
    ).join('');
}

document.getElementById('startBtn').onclick = startRace;
document.getElementById('resetBtn').onclick = () => location.reload();
</script>
</body>
</html>
