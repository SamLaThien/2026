<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Duck Racing â€” Ultimate</title>

<style>
/* --- Cáº¥u trÃºc cÆ¡ báº£n --- */
body{margin:0;background:#0f172a;color:#fff;font-family:Inter,system-ui;display:flex;justify-content:center;min-height:100vh}
.container{max-width:960px;width:100%;padding:16px;display:flex;flex-direction:column}
.card{background:#111827;border-radius:16px;padding:20px;box-shadow:0 10px 28px rgba(0,0,0,.5);margin-bottom:14px;border:1px solid #1f2937}

/* --- Input vÃ  Button --- */
h2 {margin-top:0; color:#38bdf8; text-shadow: 0 0 10px rgba(56,189,248,0.3);}
p {margin-bottom: 6px; font-size: 0.9em; color: #94a3b8;}
textarea{width:100%;min-height:100px;border-radius:12px;border:1px solid #334155;background:#020617;color:#e2e8f0;padding:12px;font-family:monospace;resize:vertical;box-sizing:border-box;}
textarea:focus{outline:2px solid #38bdf8;border-color:transparent}

.buttons{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
button{width:100%;padding:14px;border-radius:12px;border:none;font-weight:700;font-size:16px;cursor:pointer;transition:transform 0.1s}
button:active{transform:scale(0.98)}
#startBtn{background:#22c55e;color:#000}
#startBtn:hover{background:#16a34a}
.reset{background:#38bdf8;color:#000}
.reset:hover{background:#0ea5e9}

/* --- ÄÆ°á»ng Ä‘ua --- */
.timer{font-size:24px;font-weight:bold;text-align:center;margin:16px 0;font-variant-numeric:tabular-nums;color:#fbbf24}
.track{position:relative;margin-top:12px;background:#020617;border-radius:12px;border:1px solid #1e293b;padding:10px 10px 10px 0;overflow:hidden;min-height:50px}
.finish{position:absolute;right:10px;top:0;bottom:0;width:4px;background:repeating-linear-gradient(45deg, #ef4444, #ef4444 10px, #fff 10px, #fff 20px);z-index:1}

/* --- Con vá»‹t --- */
.duck{
  display:flex;align-items:center;gap:6px;
  font-size:18px; font-weight: 600;
  margin:12px 0;
  position:relative;
  left:0;
  white-space:nowrap;
  z-index:2;
  transition: transform 0.1s; /* Cho hiá»‡u á»©ng nhÃºn */
}
.duck span:first-child {font-size: 24px;} /* Icon to hÆ¡n */

/* --- Báº£ng xáº¿p háº¡ng --- */
#board {padding:0; margin-top: 10px;}
#board li{
  list-style:none;
  margin:8px 0;
  padding:12px;
  border-radius:10px;
  background:#1e293b;
  color:#fff; 
  font-weight:600;
  display:flex; justify-content:space-between;
  border: 1px solid #334155;
  animation: popIn 0.3s ease-out;
}

/* Fix lá»—i specificity: DÃ¹ng ID + Class Ä‘á»ƒ Ä‘Ã¨ lÃªn style máº·c Ä‘á»‹nh */
#board li.top1{background:#fde047;color:#000; border-color:#facc15}
#board li.top2{background:#e5e7eb;color:#000; border-color:#d1d5db}
#board li.top3{background:#fb923c;color:#000; border-color:#f97316}

@keyframes popIn {
  from{opacity:0; transform:translateY(10px)}
  to{opacity:1; transform:translateY(0)}
}
</style>
</head>

<body>
<div class="container">
  <div class="card">
    <h2 style="text-align:center">ğŸ¤ Duck Racing â€” Ultimate</h2>

    <p>Nháº­p tÃªn cÃ¡c "tay Ä‘ua" (Má»—i dÃ²ng 1 tÃªn):</p>
    <textarea id="names" placeholder="Vá»‹t Donal&#10;Vá»‹t Daisy&#10;Psyduck..."></textarea>

    <div class="buttons">
      <button id="startBtn">ğŸ Báº¯t Ä‘áº§u Ä‘ua</button>
      <button id="resetBtn" class="reset">ğŸ”„ LÃ m má»›i</button>
    </div>

    <div class="timer" id="timer">0.00s</div>

    <div class="track" id="track">
      <div class="finish"></div>
      <div style="color:#475569; text-align:center; padding:20px;">SÃ¢n Ä‘ua Ä‘ang trá»‘ng...</div>
    </div>

    <h3>ğŸ† Báº£ng xáº¿p háº¡ng</h3>
    <ul id="board"></ul>
  </div>
</div>

<script>
const btn = document.getElementById("startBtn");
const resetBtn = document.getElementById("resetBtn");
const track = document.getElementById("track");
const board = document.getElementById("board");
const timerEl = document.getElementById("timer");

let ducks = [], results = [], running = false, startTime = 0, timerLoop = null, finishX = 0;

function reset(){
  running = false;
  results = [];
  board.innerHTML = "";
  timerEl.textContent = "0.00s";
  clearInterval(timerLoop);
  
  // XÃ³a háº¿t vá»‹t cÅ©, giá»¯ láº¡i váº¡ch Ä‘Ã­ch
  track.innerHTML = '<div class="finish"></div>';
}

function startRace(){
  if(running) return;
  
  const names = document.getElementById("names").value
    .split("\n").map(s => s.trim()).filter(Boolean);

  if(!names.length){
    alert("Vui lÃ²ng nháº­p tÃªn Ã­t nháº¥t 1 con vá»‹t!");
    return;
  }

  reset(); // Clear sÃ¢n

  // TÃ­nh toÃ¡n váº¡ch Ä‘Ã­ch
  // Trá»« Ä‘i khoáº£ng 50px-80px Ä‘á»ƒ vá»‹t khÃ´ng cháº¡y lá»‘ ra ngoÃ i khung hÃ¬nh
  finishX = track.clientWidth - 70; 

  ducks = names.map((name, index) => {
    const d = document.createElement("div");
    d.className = "duck";
    d.dataset.x = 0;
    d.dataset.name = name;
    d.dataset.done = "0";
    d.dataset.speedMod = 1; // Há»‡ sá»‘ tá»‘c Ä‘á»™ riÃªng
    
    // Random icon vá»‹t hoáº·c gÃ  cho vui
    const icon = Math.random() > 0.9 ? 'ğŸ”' : 'ğŸ¦†';
    
    d.innerHTML = `<span>${icon}</span><span>${name}</span>`;
    d.style.left = "0px";
    track.appendChild(d);
    return d;
  });

  running = true;
  startTime = performance.now();

  // Timer hiá»ƒn thá»‹
  timerLoop = setInterval(() => {
    const t = ((performance.now() - startTime) / 1000).toFixed(2);
    timerEl.textContent = "â± " + t + "s";
  }, 50);

  requestAnimationFrame(loop);
}

function loop(){
  if(!running) return;

  let finishedCount = 0;

  ducks.forEach(d => {
    if(d.dataset.done === "1") {
      finishedCount++;
      return;
    }

    let x = parseFloat(d.dataset.x);

    // --- LOGIC CHUYá»‚N Äá»˜NG NÃ‚NG CAO ---
    // 1. Tá»‘c Ä‘á»™ cÆ¡ báº£n
    let move = 0.5 + Math.random() * 1.5; 
    
    // 2. Random sá»± kiá»‡n "Bá»©t tá»‘c" (Boost) - 3% cÆ¡ há»™i má»—i frame
    if(Math.random() < 0.03) {
        move += 4; // PhÃ³ng nhanh
        d.style.transform = "scale(1.2)"; // Hiá»‡u á»©ng to lÃªn khi boost
    } else {
        d.style.transform = "scale(1)"; // Trá»Ÿ láº¡i bÃ¬nh thÆ°á»ng
    }

    // 3. Random sá»± kiá»‡n "Váº¥p ngÃ£" - 1% cÆ¡ há»™i
    if(Math.random() < 0.01) {
        move = -0.5; // LÃ¹i láº¡i xÃ­u
    }

    x += move;

    // Kiá»ƒm tra vá» Ä‘Ã­ch
    if(x >= finishX){
      x = finishX;
      d.dataset.done = "1";
      d.style.transform = "scale(1)"; // Reset effect

      const t = (performance.now() - startTime) / 1000;
      results.push({ name: d.dataset.name, time: t });

      updateRanking();
    }

    d.dataset.x = x;
    d.style.left = x + "px";
  });

  // Náº¿u táº¥t cáº£ Ä‘Ã£ vá» Ä‘Ã­ch
  if(finishedCount === ducks.length && ducks.length > 0){
    running = false;
    clearInterval(timerLoop);
    timerEl.textContent = "ğŸ HOÃ€N THÃ€NH!";
  } else {
    requestAnimationFrame(loop);
  }
}

function updateRanking(){
  // Sort theo thá»i gian (nhá» nháº¥t lÃªn Ä‘áº§u)
  results.sort((a,b) => a.time - b.time);
  
  board.innerHTML = ""; // Render láº¡i báº£ng

  results.forEach((r, i) => {
    const li = document.createElement("li");
    
    // ThÃªm icon huy chÆ°Æ¡ng
    let rankPrefix = `#${i+1}`;
    if(i===0) rankPrefix = "ğŸ¥‡";
    if(i===1) rankPrefix = "ğŸ¥ˆ";
    if(i===2) rankPrefix = "ğŸ¥‰";

    li.innerHTML = `
      <span>${rankPrefix} ${r.name}</span>
      <span>${r.time.toFixed(2)}s</span>
    `;

    // Add class Ä‘á»ƒ tÃ´ mÃ u
    if(i === 0) li.classList.add("top1");
    if(i === 1) li.classList.add("top2");
    if(i === 2) li.classList.add("top3");

    board.appendChild(li);
  });
}

btn.onclick = startRace;
resetBtn.onclick = reset;
</script>
</body>
</html>
